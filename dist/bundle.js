(()=>{"use strict";class e{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(console.log("newElementId",r),this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}function t(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.minValue&&"number"==typeof e.value&&(t=t&&e.value>=e.minValue),null!=e.maxValue&&"number"==typeof e.value&&(t=t&&e.value<=e.maxValue),t}function n(e,t,n){const r=n.value;return{configurable:!0,enumerable:!1,get(){return r.bind(this)}}}var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class i{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class l extends i{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new l),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const o=l.getInstance();class a extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}renderContent(){}configure(){this.element.addEventListener("submit",this.submitHandler)}gatherUserInput(){const e=this.titleInputElement.value,n=this.descriptionInputElement.value,r=this.peopleInputElement.value,s={value:n,required:!0,minLength:5},i={value:r,required:!0,minValue:1,maxValue:5};if(t({value:e,required:!0})&&t(s)&&t(i))return[e,n,+r];alert("Invalid input, please try again")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;o.addProject(e,n,r),this.clearInputs()}}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([n],a.prototype,"submitHandler",null);var c=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class d extends e{constructor(e,t){super("single-project",e,!1,t.id),this.hostElementId=e,this.projectItem=t,this.renderContent(),this.configure()}get persons(){return 1===this.projectItem.people?"1 person":`${this.projectItem.people} persons`}dragStartHandler(e){var t;null===(t=e.dataTransfer)||void 0===t||t.setData("text/plain",this.projectItem.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").innerHTML=this.projectItem.title,this.element.querySelector("h3").innerHTML=this.persons+" assigned",this.element.querySelector("p").innerHTML=this.projectItem.description}}c([n],d.prototype,"dragStartHandler",null),c([n],d.prototype,"dragEndHandler",null);var u=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class p extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.projectType=e,this.assignedProjects=[],this.configure(),this.renderContent()}renderProjects(){document.getElementById(`${this.projectType}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new d(this.element.querySelector("ul").id,e)}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const t=e.dataTransfer.getData("text/plain");o.moveProject(t,"active"===this.projectType?r.Active:r.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),o.addListener((e=>{const t=e.filter((e=>"active"===this.projectType?e.status===r.Active:e.status===r.Finished));this.assignedProjects=t,this.renderProjects()}))}renderContent(){const e=`${this.projectType}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h1").textContent=this.projectType.toUpperCase()+" PROJECTS"}}u([n],p.prototype,"dragOverHandler",null),u([n],p.prototype,"dropHandler",null),u([n],p.prototype,"dragLeaveHandler",null),new a,new p("active"),new p("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFFBQVE4RCxjQUFjLE1BQU84QyxZQUFjcEgsS0FBS3FHLFlBQVlnQixjQUFnQixXQUNyRixFQXpDQSxHQURDMUYsRyxvQ0FVRCxHQURDQSxHLGdDQU9ELEdBRENBLEcscUNDckNMLElBQUl5QyxFQUNKLElBQUlnQyxFQUFZLFVBQ2hCLElBQUlBLEVBQVksVyIsInNvdXJjZXMiOlsid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL2Jhc2UudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL3V0aWwvdmFsaWRhdGlvbi50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvZGVjb3JhdG9ycy9hdXRvYmluZC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvbW9kZWxzL3Byb2plY3QudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL3N0YXRlL3Byb2plY3Qtc3RhdGUtbWFuYWdlbWVudC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWlucHV0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHlwZXNjcmlwdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtaXRlbS50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXR5cGVzY3JpcHQvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWxpc3QudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10eXBlc2NyaXB0Ly4vc3JjL2FwcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIEhUTUxFbGVtZW50LCBVIGV4dGVuZHMgSFRNTEVsZW1lbnQ+IHtcbiAgICB0ZW1wbGF0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgaG9zdEVsZW1lbnQ6IFQ7XG4gICAgZWxlbWVudDogVTtcblxuICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlSWQ6IHN0cmluZywgaG9zdEVsZW1lbnRJZDogc3RyaW5nLCBpbnNlcnRBdFN0YXJ0OiBib29sZWFuLCBuZXdFbGVtZW50SWQ/OiBzdHJpbmcpe1xuICAgICAgICB0aGlzLnRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRlbXBsYXRlSWQpIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChob3N0RWxlbWVudElkKSBhcyBUO1xuXG4gICAgICAgIGNvbnN0IGltcG9ydEFsbExldmVsc09mTmVzdGluZ0luc2lkZSA9IHRydWU7XG4gICAgICAgIGNvbnN0IGltcG9ydGVkTm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCwgaW1wb3J0QWxsTGV2ZWxzT2ZOZXN0aW5nSW5zaWRlKTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gaW1wb3J0ZWROb2RlLmZpcnN0RWxlbWVudENoaWxkIGFzIFU7XG4gICAgICAgIGlmIChuZXdFbGVtZW50SWQpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ25ld0VsZW1lbnRJZCcsbmV3RWxlbWVudElkKVxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmlkID0gbmV3RWxlbWVudElkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXR0YWNoKGluc2VydEF0U3RhcnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXR0YWNoKGluc2VydEF0U3RhcnQ6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoaW5zZXJ0QXRTdGFydCA/IFwiYWZ0ZXJiZWdpblwiIDogXCJiZWZvcmVlbmRcIiwgdGhpcy5lbGVtZW50KVxuICAgIH1cblxuICAgIGFic3RyYWN0IGNvbmZpZ3VyZSgpOiB2b2lkO1xuICAgIGFic3RyYWN0IHJlbmRlckNvbnRlbnQoKTogdm9pZDtcbn0iLCJleHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRhYmxlIHtcbiAgICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xuICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAgICBtaW5MZW5ndGg/OiBudW1iZXI7XG4gICAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICAgIG1pblZhbHVlPzogbnVtYmVyO1xuICAgIG1heFZhbHVlPzogbnVtYmVyO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlc1Byb3BzKHZhbGlkYXRhYmxlSW5wdXQ6IFZhbGlkYXRhYmxlKSB7XG4gICAgbGV0IGlzVmFsaWQgPSB0cnVlO1xuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0LnJlcXVpcmVkKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGggIT0gbnVsbCAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPj0gdmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGg7IFxuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGggIT0gbnVsbCAmJiB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGg7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1pblZhbHVlICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdudW1iZXInKXtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pblZhbHVlO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5tYXhWYWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnbnVtYmVyJyl7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhWYWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGlzVmFsaWQ7XG59IiwiZXhwb3J0IGZ1bmN0aW9uIEF1dG9CaW5kKF90YXJnZXQ6IGFueSwgX3Byb3BlcnR5TmFtZTogc3RyaW5nIHwgU3ltYm9sLCBkZXNjcmlwdG9yV2l0aE9yaWdpbmFsRnVuY3Rpb246IFByb3BlcnR5RGVzY3JpcHRvcikge1xuICAgIGNvbnN0IG9yaWdpbmFsRnVuY3Rpb24gPSBkZXNjcmlwdG9yV2l0aE9yaWdpbmFsRnVuY3Rpb24udmFsdWU7XG4gICAgY29uc3QgZGVzY3JpcHRvcldpdGhBdXRvQmluZDogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLCAvLyBkb2Vzbid0IHNob3cgdXAgaW4gJ2ZvciBpbicgbG9vcHNcbiAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgLy8gJ3RoaXMnIGhlcmUgcmVmZXJzIHRvIHdoYXRldmVyIGlzIHJlc3BvbnNpYmxlIGZvciB0cmlnZ2VyaW5nIGdldHRlciBtZXRob2QgXG4gICAgICAgICAgICAvLyB0aGUgZ2V0dGVkIG1ldGhvZCB3aWxsIGJlIHRyaWdnZXJlZCBieSB0aGUgY29uY3JldGUgb2JqZWN0IHRvIHdoaWNoIGl0IGJlbG9uZ3NcbiAgICAgICAgICAgIC8vICd0aGlzJyBoZXJlID0gb2JqZWN0IG9uIHdoaWNoIHdlIGRlZmluZSB0aGUgZ2V0dGVyXG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxGdW5jdGlvbi5iaW5kKHRoaXMpXG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRlc2NyaXB0b3JXaXRoQXV0b0JpbmQ7XG59IiwiZXhwb3J0IGVudW0gUHJvamVjdFN0YXR1cyB7IEFjdGl2ZSwgRmluaXNoZWQgfTtcbmV4cG9ydCBjbGFzcyBQcm9qZWN0IHtcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaWQ6IHN0cmluZywgcHVibGljIHRpdGxlOiBzdHJpbmcsIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nLCBwdWJsaWMgcGVvcGxlOiBudW1iZXIsIHB1YmxpYyBzdGF0dXM6IFByb2plY3RTdGF0dXMpIHtcbiAgICB9XG59IiwiaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xudHlwZSBMaXN0ZW5lcjxUPiA9IChpdGVtczogVFtdKSA9PiB2b2lkO1xuXG5jbGFzcyBTdGF0ZTxUPiB7XG4gICAgcHJvdGVjdGVkIGxpc3RlbmVyczogTGlzdGVuZXI8VD5bXSA9IFtdO1xuXG4gICAgYWRkTGlzdGVuZXIobGlzdGVuZXJGbjogTGlzdGVuZXI8VD4pe1xuICAgICAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGxpc3RlbmVyRm4pO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZU1hbmFnZW1lbnQgZXh0ZW5kcyBTdGF0ZTxQcm9qZWN0PntcbiAgICBwcml2YXRlIHByb2plY3RzOiBQcm9qZWN0W10gPSBbXTtcbiAgICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUHJvamVjdFN0YXRlTWFuYWdlbWVudDtcblxuICAgIHByaXZhdGUgY29uc3RydWN0b3IoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UgKCl7XG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlKXtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICAgICAgICB9IFxuICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZU1hbmFnZW1lbnQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG4gICAgfVxuXG5cbiAgICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIG51bWJlck9mUGVvcGxlOiBudW1iZXIpe1xuICAgICAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoTWF0aC5yYW5kb20oKS50b1N0cmluZygpLCB0aXRsZSwgZGVzY3JpcHRpb24sIG51bWJlck9mUGVvcGxlLCBQcm9qZWN0U3RhdHVzLkFjdGl2ZSk7XG4gICAgICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgbW92ZVByb2plY3QocHJvamVjdElkOiBzdHJpbmcsIG5ld1N0YXR1czogUHJvamVjdFN0YXR1cykge1xuICAgICAgICBjb25zdCBwcm9qZWN0VG9CZU1vdmVkID0gdGhpcy5wcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PT0gcHJvamVjdElkKVxuICAgICAgICBpZiAocHJvamVjdFRvQmVNb3ZlZCAmJiBwcm9qZWN0VG9CZU1vdmVkLnN0YXR1cyAhPT0gbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICBwcm9qZWN0VG9CZU1vdmVkLnN0YXR1cyA9IG5ld1N0YXR1cztcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7IFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVMaXN0ZW5lcnMoKSB7XG4gICAgICAgIGZvciAoY29uc3QgbGlzdGVybmVyRm4gb2YgdGhpcy5saXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3RzQ29weSA9IHRoaXMucHJvamVjdHMuc2xpY2UoKVxuICAgICAgICAgICAgbGlzdGVybmVyRm4ocHJvamVjdHNDb3B5KTsgXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGVNYW5hZ2VtZW50ID0gUHJvamVjdFN0YXRlTWFuYWdlbWVudC5nZXRJbnN0YW5jZSgpOyIsImltcG9ydCBDb21wb25lbnQgZnJvbSAnLi9iYXNlJztcbmltcG9ydCAqIGFzIFZhbGlkYXRpb24gZnJvbSAnLi4vdXRpbC92YWxpZGF0aW9uJztcbmltcG9ydCB7IEF1dG9CaW5kIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9hdXRvYmluZCc7XG5pbXBvcnQgeyBwcm9qZWN0U3RhdGVNYW5hZ2VtZW50IH0gZnJvbSAnLi4vc3RhdGUvcHJvamVjdC1zdGF0ZS1tYW5hZ2VtZW50JztcbmV4cG9ydCBjbGFzcyBQcm9qZWN0SW5wdXQgZXh0ZW5kcyBDb21wb25lbnQ8SFRNTERpdkVsZW1lbnQsIEhUTUxGb3JtRWxlbWVudD57XG4gICAgdGl0bGVJbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigncHJvamVjdC1pbnB1dCcsICdhcHAnLCB0cnVlLCBcInVzZXItaW5wdXRcIik7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignI3RpdGxlJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjZGVzY3JpcHRpb24nKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjcGVvcGxlJykgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcbiAgICB9XG5cbiAgICByZW5kZXJDb250ZW50KCl7fVxuXG4gICAgY29uZmlndXJlKCkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5zdWJtaXRIYW5kbGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdhdGhlclVzZXJJbnB1dCgpOiBbc3RyaW5nLCBzdHJpbmcsIG51bWJlcl0gfCB2b2lkIHtcbiAgICAgICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbiAgICAgICAgY29uc3QgZW50ZXJlZERlc2NyaXB0aW9uID0gdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZTtcbiAgICAgICAgY29uc3QgZW50ZXJlZFBlb3BsZSA9IHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlO1xuICAgICAgICBjb25zdCB0aXRsZVZhbGlkYXRhYmxlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uVmFsaWRhdGFibGU6IFZhbGlkYXRpb24uVmFsaWRhdGFibGUgPSB7XG4gICAgICAgICAgICB2YWx1ZTogZW50ZXJlZERlc2NyaXB0aW9uLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDUsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHBlb3BsZVZhbGlkYXRhYmxlOiBWYWxpZGF0aW9uLlZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgdmFsdWU6IGVudGVyZWRQZW9wbGUsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIG1pblZhbHVlOiAxLFxuICAgICAgICAgICAgbWF4VmFsdWU6IDVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgIVZhbGlkYXRpb24udmFsaWRhdGVzUHJvcHModGl0bGVWYWxpZGF0YWJsZSkgfHxcbiAgICAgICAgICAgICFWYWxpZGF0aW9uLnZhbGlkYXRlc1Byb3BzKGRlc2NyaXB0aW9uVmFsaWRhdGFibGUpIHx8XG4gICAgICAgICAgICAhVmFsaWRhdGlvbi52YWxpZGF0ZXNQcm9wcyhwZW9wbGVWYWxpZGF0YWJsZSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBhbGVydCgnSW52YWxpZCBpbnB1dCwgcGxlYXNlIHRyeSBhZ2FpbicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBlbnRlcmVkVGl0bGUsXG4gICAgICAgICAgICBlbnRlcmVkRGVzY3JpcHRpb24sXG4gICAgICAgICAgICArZW50ZXJlZFBlb3BsZVxuICAgICAgICBdXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhcklucHV0cygpIHtcbiAgICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICAgICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7IFxuICAgIH1cbiAgICBAQXV0b0JpbmRcbiAgICBwcml2YXRlIHN1Ym1pdEhhbmRsZXIoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuZ2F0aGVyVXNlcklucHV0KCk7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHVzZXJJbnB1dCkpIHtcbiAgICAgICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzY3JpcHRpb24sIHBlb3BsZV0gPSB1c2VySW5wdXQ7XG4gICAgICAgICAgICBwcm9qZWN0U3RhdGVNYW5hZ2VtZW50LmFkZFByb2plY3QodGl0bGUsIGRlc2NyaXB0aW9uLCBwZW9wbGUpO1xuICAgICAgICAgICAgdGhpcy5jbGVhcklucHV0cygpO1xuICAgICAgICB9XG4gICAgfVxuXG59IiwiaW1wb3J0IHsgRHJhZ2FiYmxlIH0gZnJvbSAnLi4vbW9kZWxzL2RyYWctZHJvcCc7XG5pbXBvcnQgeyBBdXRvQmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQnO1xuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gJy4uL21vZGVscy9wcm9qZWN0JztcbmltcG9ydCBDb21wb25lbnQgZnJvbSAnLi9iYXNlJztcblxuZXhwb3J0IGNsYXNzIFByb2plY3RJdGVtIGV4dGVuZHMgQ29tcG9uZW50PEhUTUxVTGlzdEVsZW1lbnQsIEhUTUxMSUVsZW1lbnQ+IGltcGxlbWVudHMgRHJhZ2FiYmxlIHtcbiAgICBjb25zdHJ1Y3RvciAocHVibGljIGhvc3RFbGVtZW50SWQ6IHN0cmluZywgcHVibGljIHByb2plY3RJdGVtOiBQcm9qZWN0KXtcbiAgICAgICAgc3VwZXIoXCJzaW5nbGUtcHJvamVjdFwiLCBob3N0RWxlbWVudElkLCBmYWxzZSwgcHJvamVjdEl0ZW0uaWQpO1xuICAgICAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcbiAgICB9XG4gICAgZ2V0IHBlcnNvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLnByb2plY3RJdGVtLnBlb3BsZSA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiMSBwZXJzb25cIjtcbiAgICAgICAgfSBcbiAgICAgICAgcmV0dXJuIGAke3RoaXMucHJvamVjdEl0ZW0ucGVvcGxlfSBwZXJzb25zYDtcbiAgICB9XG5cbiAgICBAQXV0b0JpbmRcbiAgICBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcGxhaW5UZXh0Zm9ybWF0ID0gJ3RleHQvcGxhaW4nO1xuICAgICAgICBjb25zdCBjdXJzb3JUeXBlID0gJ21vdmUnO1xuICAgICAgICBldmVudC5kYXRhVHJhbnNmZXI/LnNldERhdGEocGxhaW5UZXh0Zm9ybWF0LCB0aGlzLnByb2plY3RJdGVtLmlkKTtcbiAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyIS5lZmZlY3RBbGxvd2VkID0gY3Vyc29yVHlwZTtcbiAgICB9XG4gICAgQEF1dG9CaW5kXG4gICAgZHJhZ0VuZEhhbmRsZXIoX2V2ZW50OiBEcmFnRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0RyYWdFbmQnKVxuICAgIH1cbiAgICBjb25maWd1cmUoKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2VuZCcsIHRoaXMuZHJhZ0VuZEhhbmRsZXIpO1xuICAgIH1cblxuICAgIHJlbmRlckNvbnRlbnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdoMicpIS5pbm5lckhUTUwgPSB0aGlzLnByb2plY3RJdGVtLnRpdGxlO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDMnKSEuaW5uZXJIVE1MID0gdGhpcy5wZXJzb25zICsgJyBhc3NpZ25lZCc7XG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdwJykhLmlubmVySFRNTCA9IHRoaXMucHJvamVjdEl0ZW0uZGVzY3JpcHRpb247XG4gICAgfVxufVxuXG5cblxuIiwiaW1wb3J0IHsgRHJhZ1RhcmdldCB9IGZyb20gJy4uL21vZGVscy9kcmFnLWRyb3AnO1xuaW1wb3J0IHsgQXV0b0JpbmQgfSBmcm9tICcuLi9kZWNvcmF0b3JzL2F1dG9iaW5kJztcbmltcG9ydCB7IFByb2plY3QsIFByb2plY3RTdGF0dXMgfSBmcm9tICcuLi9tb2RlbHMvcHJvamVjdCc7XG5pbXBvcnQgQ29tcG9uZW50IGZyb20gJy4vYmFzZSc7XG5pbXBvcnQgeyBwcm9qZWN0U3RhdGVNYW5hZ2VtZW50IH0gZnJvbSAnLi4vc3RhdGUvcHJvamVjdC1zdGF0ZS1tYW5hZ2VtZW50JztcbmltcG9ydCB7IFByb2plY3RJdGVtIH0gZnJvbSAnLi9wcm9qZWN0LWl0ZW0nO1xuZXhwb3J0IGNsYXNzIFByb2plY3RMaXN0IGV4dGVuZHMgQ29tcG9uZW50PEhUTUxEaXZFbGVtZW50LCBIVE1MRWxlbWVudD4gaW1wbGVtZW50cyBEcmFnVGFyZ2V0e1xuICAgIGFzc2lnbmVkUHJvamVjdHM6IFByb2plY3RbXTtcblxuICAgIGNvbnN0cnVjdG9yIChwcml2YXRlIHByb2plY3RUeXBlOiAnYWN0aXZlJyB8ICdmaW5pc2hlZCcpe1xuICAgICAgICBzdXBlcigncHJvamVjdC1saXN0JywgJ2FwcCcsIGZhbHNlLCBgJHtwcm9qZWN0VHlwZX0tcHJvamVjdHNgKTtcbiAgICAgICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gW107XG4gICAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuICAgIH1cblxuICAgIHJlbmRlclByb2plY3RzKCkge1xuICAgICAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHt0aGlzLnByb2plY3RUeXBlfS1wcm9qZWN0cy1saXN0YCkhIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XG4gICAgICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgZm9yIChjb25zdCBwcm9qZWN0SXRlbSBvZiB0aGlzLmFzc2lnbmVkUHJvamVjdHMpIHtcbiAgICAgICAgICAgIG5ldyBQcm9qZWN0SXRlbSh0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQsIHByb2plY3RJdGVtKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBBdXRvQmluZFxuICAgIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmIChldmVudC5kYXRhVHJhbnNmZXIgJiYgZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzWzBdID09PSAndGV4dC9wbGFpbicpe1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gYWxsb3dzIGRyb3BwaW5nXG4gICAgICAgICAgICBjb25zdCBsaXN0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpITtcbiAgICAgICAgICAgIGxpc3RFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Ryb3BwYWJsZScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQEF1dG9CaW5kXG4gICAgZHJvcEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQge1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSAgZXZlbnQuZGF0YVRyYW5zZmVyIS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG4gICAgICAgIHByb2plY3RTdGF0ZU1hbmFnZW1lbnQubW92ZVByb2plY3QocHJvamVjdElkLCB0aGlzLnByb2plY3RUeXBlID09PSAnYWN0aXZlJyA/IFByb2plY3RTdGF0dXMuQWN0aXZlIDogUHJvamVjdFN0YXR1cy5GaW5pc2hlZCk7XG4gICAgfVxuXG4gICAgQEF1dG9CaW5kXG4gICAgZHJhZ0xlYXZlSGFuZGxlcihfZXZlbnQ6IERyYWdFdmVudCk6IHZvaWQge1xuICAgICAgICBjb25zdCBsaXN0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpITtcbiAgICAgICAgbGlzdEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcHBhYmxlJyk7XG4gICAgfVxuICAgIGNvbmZpZ3VyZSgpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3ZlckhhbmRsZXIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgdGhpcy5kcmFnTGVhdmVIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyKTtcbiAgICAgICAgXG4gICAgICAgIHByb2plY3RTdGF0ZU1hbmFnZW1lbnQuYWRkTGlzdGVuZXIoKHByb2plY3RzOiBQcm9qZWN0W10pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlbGV2YW50UHJvamVjdHMgPSBwcm9qZWN0cy5maWx0ZXIocHJvamVjdCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJvamVjdFR5cGUgPT09ICdhY3RpdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9qZWN0LnN0YXR1cyA9PT0gUHJvamVjdFN0YXR1cy5BY3RpdmU7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvamVjdC5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuRmluaXNoZWQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gcmVsZXZhbnRQcm9qZWN0cztcbiAgICAgICAgICAgIHRoaXMucmVuZGVyUHJvamVjdHMoKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICByZW5kZXJDb250ZW50KCkge1xuICAgICAgICBjb25zdCBsaXN0SWQgPSBgJHt0aGlzLnByb2plY3RUeXBlfS1wcm9qZWN0cy1saXN0YDtcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhLmlkID0gbGlzdElkO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDEnKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3RUeXBlLnRvVXBwZXJDYXNlKCkgKyAnIFBST0pFQ1RTJztcbiAgICB9XG59IiwiaW1wb3J0IHsgUHJvamVjdElucHV0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWlucHV0XCI7XG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gXCIuL2NvbXBvbmVudHMvcHJvamVjdC1saXN0XCI7XG5uZXcgUHJvamVjdElucHV0KCk7XG5uZXcgUHJvamVjdExpc3QoJ2FjdGl2ZScpO1xubmV3IFByb2plY3RMaXN0KCdmaW5pc2hlZCcpOyJdLCJuYW1lcyI6WyJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInRlbXBsYXRlSWQiLCJob3N0RWxlbWVudElkIiwiaW5zZXJ0QXRTdGFydCIsIm5ld0VsZW1lbnRJZCIsInRoaXMiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImNvbnNvbGUiLCJsb2ciLCJpZCIsImF0dGFjaCIsImluc2VydEFkamFjZW50RWxlbWVudCIsInZhbGlkYXRlc1Byb3BzIiwidmFsaWRhdGFibGVJbnB1dCIsImlzVmFsaWQiLCJyZXF1aXJlZCIsInZhbHVlIiwidG9TdHJpbmciLCJ0cmltIiwibGVuZ3RoIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwibWluVmFsdWUiLCJtYXhWYWx1ZSIsIkF1dG9CaW5kIiwiX3RhcmdldCIsIl9wcm9wZXJ0eU5hbWUiLCJkZXNjcmlwdG9yV2l0aE9yaWdpbmFsRnVuY3Rpb24iLCJvcmlnaW5hbEZ1bmN0aW9uIiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsImJpbmQiLCJQcm9qZWN0U3RhdHVzIiwiUHJvamVjdCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJwZW9wbGUiLCJzdGF0dXMiLCJTdGF0ZSIsImxpc3RlbmVycyIsImFkZExpc3RlbmVyIiwibGlzdGVuZXJGbiIsInB1c2giLCJQcm9qZWN0U3RhdGVNYW5hZ2VtZW50Iiwic3VwZXIiLCJwcm9qZWN0cyIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJhZGRQcm9qZWN0IiwibnVtYmVyT2ZQZW9wbGUiLCJuZXdQcm9qZWN0IiwiTWF0aCIsInJhbmRvbSIsIkFjdGl2ZSIsInVwZGF0ZUxpc3RlbmVycyIsIm1vdmVQcm9qZWN0IiwicHJvamVjdElkIiwibmV3U3RhdHVzIiwicHJvamVjdFRvQmVNb3ZlZCIsImZpbmQiLCJwcm9qZWN0IiwibGlzdGVybmVyRm4iLCJzbGljZSIsInByb2plY3RTdGF0ZU1hbmFnZW1lbnQiLCJQcm9qZWN0SW5wdXQiLCJ0aXRsZUlucHV0RWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJkZXNjcmlwdGlvbklucHV0RWxlbWVudCIsInBlb3BsZUlucHV0RWxlbWVudCIsImNvbmZpZ3VyZSIsInJlbmRlckNvbnRlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0SGFuZGxlciIsImdhdGhlclVzZXJJbnB1dCIsImVudGVyZWRUaXRsZSIsImVudGVyZWREZXNjcmlwdGlvbiIsImVudGVyZWRQZW9wbGUiLCJkZXNjcmlwdGlvblZhbGlkYXRhYmxlIiwicGVvcGxlVmFsaWRhdGFibGUiLCJhbGVydCIsImNsZWFySW5wdXRzIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInVzZXJJbnB1dCIsIkFycmF5IiwiaXNBcnJheSIsIlByb2plY3RJdGVtIiwicHJvamVjdEl0ZW0iLCJwZXJzb25zIiwiZHJhZ1N0YXJ0SGFuZGxlciIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJlZmZlY3RBbGxvd2VkIiwiZHJhZ0VuZEhhbmRsZXIiLCJfZXZlbnQiLCJpbm5lckhUTUwiLCJQcm9qZWN0TGlzdCIsInByb2plY3RUeXBlIiwiYXNzaWduZWRQcm9qZWN0cyIsInJlbmRlclByb2plY3RzIiwiZHJhZ092ZXJIYW5kbGVyIiwidHlwZXMiLCJjbGFzc0xpc3QiLCJhZGQiLCJkcm9wSGFuZGxlciIsImdldERhdGEiLCJGaW5pc2hlZCIsImRyYWdMZWF2ZUhhbmRsZXIiLCJyZW1vdmUiLCJyZWxldmFudFByb2plY3RzIiwiZmlsdGVyIiwibGlzdElkIiwidGV4dENvbnRlbnQiLCJ0b1VwcGVyQ2FzZSJdLCJzb3VyY2VSb290IjoiIn0=